# TYPELINER(1)

## 名前

typeliner - 端末からの入力文字を改行コードを付けて即座に出力

## 書式

```sh:
typeliner [options]
```

## 説明

通常、端末からタイプされた文字は入力キュー（stdio.hによるバッファとは別のもの）に滞留し、[Enter]キーが押された時点でまとまって標準出力に送り出されます。それに対してこのコマンドを使うと、キータイプされた文字が直ちに標準出力に送られます。その際、文字の後に改行コードも付加されます（タイプされたキーが[Enter]だった場合を除く）。これにより、タイプされた各文字が、行指向で動く他のほとんどのUNIXコマンドまたはシェルスクリプトでリアルタイムに処理できます（stdbuf(1)や[ptw(1)](ptw.man.ja.md)などを用いてフルバッファリングモードを解除した場合）。

このような特徴を持っているコマンドであるため、本コマンドの入力側を端末に繋がずに使うことには意味がありません。具体的には、

* コマンドパイプラインの途中に本コマンドを置くような使い方
* 標準入力のisatty(2)の結果が0になるような環境
* test(1)コマンドで`[ -t 0 ]`を実行した際の戻り値が0以外

のようなケースでは意味が無いということです。上記のようなケースでも動作しますが、cat(1)コマンドと同様に、標準入力から到来したデータを標準出力に転送するという動作をするだけになってしまいます。

なお、コピー&ペーストなどによって複数文字が一度に到来した場合には、それらをまとめて1文字として扱い、改行コードはそれらの最後に1個だけ付加します。

各種オプションについては別途説明します。

## オプション

### -1

起動後、キーボードからの入力を1文字受け取り、改行コードを付けて標準出力に送り出した時点で直ちに終了します。-nオプションを`-n 1`として使用した場合と同じです。これは、sh(1)の内部コマンドであるreadの代替品として使うと便利な場合があります。readコマンドでは[Enter]キーが押されるまでシェル変数にタイプされた文字列が代入されませんが、このコマンドを使えば[Enter]キーを待つことなく、タイプした文字を直ちにシェル変数で受け取れます。（「使用例」のセクションを参照）

ここでの「文字」とは端末からタイプされるひとまとまりのことであり、コピー&ペーストなどによって複数文字が一気にタイプされた場合にはそれで1回とカウントされます。また、このオプションは、本コマンドの入力側が端末である場合にのみ有効です。（そうでなかった場合には無視されます）

### -d

[Ctrl]+[D]によって発生するEOTキャラクターを特別扱いしません。UNIXコマンドは一般的に、[Ctrl]+[D]がタイプされるとキータイプの受け付けを終了します。本コマンドも同様ですが、このオプションを付けるとそれを行わず、EOTの文字コードである0x04として他の文字同様に扱います。EOTも同様にタイプしたい場合に使ってください。

このオプションは、本コマンドの入力側が端末である場合にのみ有効です。（そうでなかった場合には無視されます）

### -e

ローカルエコーを有効にします。例えば、下記に示す1番目の例では、タイプした文字が画面に表示されませんが、2番目の例では表示されます。

```sh:
$ typiliner > mytyling.txt
$ typiliner -e > mytyling.txt
```

このオプションは、本コマンドの入力側が端末である場合にのみ有効です。（そうでなかった場合には無視されます）

### -n *num*

起動後、キーボードからの入力を*num*文字受け取り、改行コードを付けて標準出力に送り出した時点で直ちに終了します。`-n 1`として使用した場合とは、-1オプションと同じです。

ここでの「文字」とは端末からタイプされるひとまとまりのことであり、コピー&ペーストなどによって複数文字が一気にタイプされた場合にはそれで1回とカウントされます。また、このオプションは、本コマンドの入力側が端末である場合にのみ有効です。（そうでなかった場合には無視されます）

### -t *str*

タイプされた文字を標準出力に書き出す際、通常であれば末尾に改行コードを付加しますが、それを*str*で定義された文字列にします。例えば、`typeliner -t ,`とすればカンマ区切りになります。

このオプションは、本コマンドの入力側が端末である場合にのみ有効です。（そうでなかった場合には無視されます）

## 戻り値

-1や-nオプションを用いたり、[Ctrl]+[D]を押下するなどによって正常に処理できた場合にのみ0を戻します。引数・オプションが不正であった場合、[Ctrl]+[C]などで中断された場合には0以外を戻します。

## 使用例

タイプされた文字を直ちにシェル変数confirmに代入する。

```sh:
printf 'Are you sure? (Y/N): '
confirm=$(typeliner -1e)
```

本コマンドと[linets(1)](linets.man.ja.md)コマンドを使って自分のタイピングを記録した後、再生する。

```sh:
$ typeliner -e | linets -3 > mytyping.txt
（文字をタイプした後、最後に[Ctrl]+[D]を押す）
$ tscat -yZ mytyping.txt
（先程のタイピングの様子が画面に再現される）
```

## バグ

-tオプションの動作に若干の既知の問題が二つあります。これらは将来的に修正する予定です。

一つは[Enter]を（単独で）押下した場合には改行コードがそのまま出力されます。もう一つはコピー&ペーストなどによって一気に文字列が入力され、かつその文字列の途中に改行コードが含まれている場合も改行コードがそのまま出力されます。

## 規格への準拠

このコマンドのソースコードはC99、IEEE Std 1003.1-2001（“POSIX.1”）に準拠させてあります。

## 関連項目

[linets(1)](linets.man.ja.md)、[tscat(1)](tscat.man.ja.md)
