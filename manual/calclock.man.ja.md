# CALCLOCK(1)

## 名前

calclock - カレンダー時間とUNIX時間の相互変換

## 書式

```sh:
calclock [+[n]h] [-r] f1 [f2 [...]] file
calclock -d[r] string
```

## 説明

crontab(5)やfstab(5)のような空白区切りのテキストデータ形式のfileを与え、その中の指定列（f1、f2、……で指定）にカレンダー時間（"YYYYMMDDhhmmss[.d]"、"d"は秒未満）または、UNIX時間（"n[.d]"、"d"は秒未満）が格納されているとみなし、その列の右隣にUNIX時間、またはカレンダー時間に変換した列を挿入します。

なお、カレンダー時間とUNIX時間の相互変換にはタイムゾーンの情報が必要ですが、カレンダー時刻については、現在の環境に設定されているタイムゾーン設定のものと見なします。タイムゾーンを明示したい場合には、環境変数TZを設定してください。（「使用例」のセクションを参照）

各種引数・オプションについては別途説明します。

## 引数の説明

### f1, f2, ......

列番号。変換対象の日時データが格納されている列の番号を自然数で指定します。最低一つ指定しなければなりません。また、複数指定可能です。

### file

データ源となるファイル。省略したり、`-`を指定した場合には標準出力と見なされます。複数指定はできません。

### string

変換対象となるカレンダー時間またはUNIX時間文字列を引数として直接指定するための引数です。-dオプションが指定された場合に設定可能です。

## オプション

### +[n]h

ヘッダー行数指定。列名を記した行など、変換対象日時データの入っていない行が先頭にn行ある場合に、その行を何も加工せずに出力します。nは省略可能で、省略した場合は1と見なされます。また、このオプションそのものを省略した場合は0（ヘッダー行なし）と見なされます。

### -r

逆変換モード。このオプションを指定しなかった場合、指定行に入っているデータをカレンダー時間（YYYYMMDDhhmmss[.d]、dは秒未満）とみなし、UNIX時間（n[.d]、dは秒未満）に変換した列を右隣に挿入するという「正変換」を行いますが、このオプションを指定した場合は、指定行に入っているデータをUNIX時間と見なし、カレンダー時間に変換した列を右隣に挿入します。

### -d

ダイレクトモード。変換対象時刻を引数で直接指定するためのモードです。結果は、`元の時間 変換された時間`という2列で出力されます。

## 戻り値

指定されたファイルを正常に処理できた場合にのみ0を戻し、引数やオプション、ファイル、内容の異常により正常に処理できなかった場合には0以外を戻します。

## 使用例

元データacess.logの内容が次のようなものだったとする。


```text:acess.log
20220718000000 user1: log in
20220718000010 user1: access "members.cgi"
20220718000030 user1: log out
```

これに対し、1列目のデータをUNIX時間へ正変換（ただしタイムゾーンは日本時間）し、ファイルaccess2.logに格納する。

```sh:
$ export TZ=JST-9
$ calclock 1 acess.log > access2.log
```

生成されたファイルaccess2.logの内容は次のとおり。

```text:acess2.log
20220718000000 1658070000 user1: log in
20220718000010 1658070010 user1: access "members.cgi"
20220718000030 1658070030 user1: log out
```

## 歴史

このコマンドのオリジナルは、USP研究所によるOpen usp Tukubaiであり、それをPOSIX準拠のシェルスクリプトに移植したものです。機能的には上位互換のはずです。

## 規格への準拠

このコマンドはIEEE Std 1003.1-2001（“POSIX.1”）に準拠したsh向けのシェルスクリプトで書かれており、かつ、呼び出している各コマンドは同規格の仕様の範囲内です。
