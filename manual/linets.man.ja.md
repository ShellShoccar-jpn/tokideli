# LINETS(1)

## 名前

linets - 行頭に各行の読み込みを挿入して出力

## 書式

```sh:
linets [-0|-3|-6|-9] [-c|-e|-z|-Z] [-du] [file [...]]
```

## 説明

テキストファイルであるfileから各行を読み込み、その行の1文字目を読み込んだ時刻をタイムスタンプとして行頭に挿入しつつ、行全体を標準出力へ出力します。タイムスタンプの精度（秒単位からナノ秒単位まで）やフォーマット（カレンダー時間やUNIX時間など）、さらに前の行との差分も付加するかなどはオプションで切り替えられます。

それぞれの具体的なフォーマットについては後述する各オプション（-c、-e、-z、-Z）の説明を参照してください。

## 引数の説明

### file

データ源となるファイル。省略したり、`-`を指定した場合には標準出力と見なされます。複数指定することも可能です。

## オプション

### -0, -3, -6, -9

付加するタイムスタンプの精度を指定します。-0、-3、-6、-9はそれぞれ、秒単位、ミリ秒単位、マイクロ秒単位、ナノ秒単位を意味し、それぞれのオプションは互いに排他的です。これらがいずれも指定されなかった場合には-0が指定されたものと見なします。

また、-dオプションを併用していた場合には、それによって付加される前行出力時刻からの経過秒数についても同じ精度が適用されます。

### -c, -e, -z, -Z

タイムスタンプのフォーマットを指定します。-c、-e、-z、-Zはそれぞれ、カレンダー時間（"YYYYMMDDhhmmzz"の14桁整数部を持つ）、UNIX時間（UTCタイムゾーンにおける1970-01-01T00:00:00からの経過秒数）、本コマンド起動時からの経過秒数、テキストデータの1行目の1文字目到来時刻からの経過秒数を意味し、それぞれのオプションは互いに排他的です。これらがいずれも指定されなかった場合には-cが指定されたものと見なします。以下に、それぞれのオプションにおけるフォーマットの詳細を記します。

#### -c: カレンダー時間

読み込んだ行データの内容が“foo bar 123”である場合、次のようなフォーマットで出力されます。

```text:
YYYYMMDDhhmmss.ddddddddd foo bar 123
```

すなわち、カレンダー時間の14桁整数値YYYYMMDDhhmmss、次いで-3、-6、-9オプションを使っている場合には小数点"."に続いてそれぞれの精度での小数部d（-0の場合には小数点を含めて表示されない）、そして半角空白" "の1文字が先頭に付き、その後に元の1行分のテキストデータが表示されます。

なお、14桁整数値はOSに設定されているタイムゾーンに依存します。明示的にタイムゾーンを指定したい場合には環境変数TZで設定してください。（「使用例」のセクションを参照）

#### -e: UNIX時間

読み込んだ行データの内容が“foo bar 123”である場合、次のようなフォーマットで出力されます。

```text:
n.ddddddddd foo bar 123
```

すなわち、UNIX時間の整数値n、次いで-3、-6、-9オプションを使っている場合には小数点"."に続いてそれぞれの精度での小数部d（-0の場合には小数点を含めて表示されない）、そして半角空白" "の1文字が先頭に付き、その後に元の1行分のテキストデータが表示されます。

#### -z: 本コマンド起動時からの経過秒数

読み込んだ行データの内容が“foo bar 123”である場合、次のようなフォーマットで出力されます。

```text:
n.ddddddddd foo bar 123
```

すなわち、本コマンド起動時刻からの経過秒数を表す整数値n、次いで-3、-6、-9オプションを使っている場合には小数点"."に続いてそれぞれの精度での小数部d（-0の場合には小数点を含めて表示されない）、そして半角空白" "の1文字が先頭に付き、その後に元の1行分のテキストデータが表示されます。

#### -Z: テキストデータの1行目の1文字目到来時刻からの経過秒数

読み込んだ行データの内容が“foo bar 123”である場合、次のようなフォーマットで出力されます。

```text:
n.ddddddddd foo bar 123
```

すなわち、1行目（厳密にはその先頭1文字）到来時刻からの経過秒数を表す整数値n、次いで-3、-6、-9オプションを使っている場合には小数点"."に続いてそれぞれの精度での小数部d（-0の場合には小数点を含めて表示されない）、そして半角空白" "の1文字が先頭に付き、その後に元の1行分のテキストデータが表示されます。

従って1行目のタイムスタンプは必ず0になります。有効桁数内において0になるのではなく、厳密に0であるため、小数部は表示しません。

### -d

1列目のタイムスタンプの後に2列目として、前の行の到来事項からの経過秒数を挿入します。したがって、このオプションを用いた場合、元々の文字列は3列目に表示されます。

読み込んだ行データの内容が“foo bar 123”である場合、次のようなフォーマットで出力されます。

```text:
TIMESTAMP n.ddddddddd foo bar 123
```

"TIMESTAMP"で示した列は、タイムスタンプフォーマット指定オプション（-c、-e、-z、-Z）で指定された際の1列目と同じです。2列目は、前行（厳密にはその先頭1文字）到来時刻から、この行の1文字目"f"が到来した時刻の差であり、nはその整数部、続いて-3、-6、-9オプションを使っている場合には小数点"."に続いてそれぞれの精度での小数部d（-0の場合には小数点を含めて表示されない）、そして半角空白" "の1文字が先頭に付き、その後に元の1行分のテキストデータが表示されます。

なお、1行目については前の列が存在しないため、2列目は基本的に"0"にする。ただし、-zオプションが指定された場合に限り、コマンド起動時の時刻からの経過秒数（結果的に1列目と同じ値）を表示する。

### -u

タイムゾーンをUTCに設定します。これは環境変数TZに`UTC+0`を設定する場合と同じです。このオプションは、-cオプション指定時の表示内容に影響します。

## 戻り値

指定されたすべてのファイルを正常に処理できた場合にのみ0を戻し、引数・オプションが不正であった場合や一つでもファイル処理に失敗した場合には0以外を戻します。

## 使用例

ping(8)の出力に、JST-9タイムゾーンによるカレンダー時間、かつミリ秒単位までのタイムスタンプを付ける。

```sh:
$ ping example.com | linets -3
```

`sleep 1`を繰り返し実行し、その際のタイムスタンプと差分をマイクロ秒単位まで表示することで、実際の1周はどれくらいかかっているのかを調べる。

```sh:
$ while sleep 1; do echo; done | linets -6d
```

## バグ

コマンド自体はナノ秒単位まで表示しますが、その時刻が正確とは限りません。どれくらい正確かはOSの状態やハードウェアの性能に依存します。

## 規格への準拠

このコマンドのソースコードはC99、IEEE Std 1003.1-2001（“POSIX.1”）に準拠させてあります。

## 関連項目

[tscat(1)](tscat.man.ja.md)、[LINETS & TSCATチュートリアル](linets_and_tscat.ja.md)
